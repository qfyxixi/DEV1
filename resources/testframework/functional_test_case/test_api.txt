*** Settings ***
Library           Selenium2Library
Library           HttpLibrary.HTTP
Library           zuanyi.py
Library           HttpLibrary
Library           Collections
Library           string
Library           RequestsLibrary
Library           zuanyi.py
Library           selectActionId.py
Library           select_Serial_no.py

*** Test Cases ***
creat
    zuanyi
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&userName=u&hotelName=hotel1001&provinceCode=10001&cityCode=beijingcity&operateType=0
    HttpLibrary.HTTP.POST    /offlineInfo/hotelInfo/createHotel.do
    log response body
    ${createhotelresponsebody}=    get response body
    ${hotelNo}=    Get Json Value    ${createhotelresponsebody}    /data/hotelNo
    log    ${hotelNo}
    ${hotelNo}=    evaluate    int(${hotelNo})
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&hotelNo=${hotelNo}&roomTypeName=roomType100&roomTypeCgptPrice=200&roomInfo=[{"roomName":"roomType1000room001"}, {"roomName":"roomType1000room002"}, {"roomName":"roomType1000room003"}]
    HttpLibrary.HTTP.POST    /offlineInfo/roomTypeInfo/saveRoomType.do
    log response body
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&hotelNo=${hotelNo}&roomTypeName=roomType101&roomTypeCgptPrice=200&roomInfo=[{"roomName":"roomType1011room001"}, {"roomName":"roomType1011room002"}, {"roomName":"roomType1011room003"}]
    HttpLibrary.HTTP.POST    /offlineInfo/roomTypeInfo/saveRoomType.do
    log response body
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    hotelNo=${hotelNo}&userName=u&userGuid=uid100
    HttpLibrary.HTTP.POST    /offlineInfo/roomInfo/queryRoomInfoByHotelNo.do
    Log Response Status
    ${query_hotel_information}=    get response body
    log response body
    ${json}    to json    ${query_hotel_information}
    ${hotelNo}=    set variable    ${json['data']['roomInfoList'][0]['hotelNo']}
    ${roomType1000_roomTypeNo}=    set variable    ${json['data']['roomInfoList'][0]['roomTypeNo']}
    ${roomType1000room001_roomNo}=    set variable    ${json['data']['roomInfoList'][0]['roomNo']}
    ${roomType1000room002_roomNo}=    set variable    ${json['data']['roomInfoList'][1]['roomNo']}
    ${roomType1011_roomTypeNo}=    set variable    ${json['data']['roomInfoList'][3]['roomTypeNo']}
    ${roomType1011room001_roomNo}=    set variable    ${json['data']['roomInfoList'][3]['roomNo']}
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    hotelNo=${hotelNo}&userName=u&des=uid100_create_first_order&userGuid=uid100&stays=[{"checkInTime":"2016-06-11 14:00", "checkOutTime":"2016-06-11 16:00", "customer":"one-order-several-rooms-uid100", "customerTel":"13312345601","roomNo":"${roomType1000room001_roomNo}", "roomPrice":"380", "roomTypeNo":"${roomType1000_roomTypeNo}"},{"checkInTime":"2016-06-11 14:00", "checkOutTime":"2016-06-11 16:00", "customer":"one-order-several-rooms-uid100","customerTel":"13312345602","roomNo":"${roomType1000room002_roomNo}", "roomPrice":"480", "roomTypeNo":"${roomType1000_roomTypeNo}"},{"checkInTime":"2016-06-13 14:00", "checkOutTime":"2016-06-15 16:00", "customer":"one-order-several-rooms-uid100", "customerTel":"13312345603","roomNo":"${roomType1011room001_roomNo}", "roomPrice":"680", "roomTypeNo":"${roomType1011_roomTypeNo}"}]&fromType=wsm&channelId=SANKEQD
    HttpLibrary.HTTP.POST    /sm/common/order/createOrder.do
    log response body
    ${get_orderNo}=    get Response body
    ${json}    to json    ${get_orderNo}
    ${orderNo}=    set variable    ${json['data']['orderNo']}
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userId=uid100&userName=u&canCancel=canCancel&statusCode=306&cancelReasonCode=10&orderNo=${orderNo}&token=QaBs3Qe9WBcs2db&cancelReasonName=特殊原因
    HttpLibrary.HTTP.POST    /api/updateOrder.do
    log response body
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    hotelNo=${hotelNo}&userName=u&des=uid100_create_first_order&userGuid=uid100&stays=[{"checkInTime":"2016-06-11 14:00", "checkOutTime":"2016-06-11 16:00", "customer":"one-order-several-rooms-uid100", "customerTel":"13312345601","roomNo":"${roomType1000room001_roomNo}", "roomPrice":"380", "roomTypeNo":"${roomType1000_roomTypeNo}"},{"checkInTime":"2016-06-11 14:00", "checkOutTime":"2016-06-11 16:00", "customer":"one-order-several-rooms-uid100","customerTel":"13312345602","roomNo":"${roomType1000room002_roomNo}", "roomPrice":"480", "roomTypeNo":"${roomType1000_roomTypeNo}"},{"checkInTime":"2016-06-11 14:00", "checkOutTime":"2016-06-11 16:00", "customer":"one-order-several-rooms-uid100", "customerTel":"13312345603","roomNo":"${roomType1011room001_roomNo}", "roomPrice":"680", "roomTypeNo":"${roomType1011_roomTypeNo}"}]&fromType=wsm&channelId=SANKEQD
    HttpLibrary.HTTP.POST    /sm/common/order/createOrder.do
    ${get_orderNo}=    get Response body
    ${json}    to json    ${get_orderNo}
    ${orderNo}=    set variable    ${json['data']['orderNo']}
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&orderNo=${orderNo}&userName=u
    HttpLibrary.HTTP.POST    /sm/common/order/queryOrder.do
    log response body
    ${get_stayId}=    get Response body
    ${json}    to json    ${get_stayId}
    ${orderNo}=    set variable    ${json['data']['order']['orderNo']}
    ${stayId1}=    set variable    ${json['data']['stays'][0]['stayId']}
    ${stayId1_roomNo}=    set variable    ${json['data']['stays'][0]['roomNo']}
    ${stayId2}=    set variable    ${json['data']['stays'][1]['stayId']}
    ${stayId2_roomNo}=    set variable    ${json['data']['stays'][1]['roomNo']}
    ${stayId3}=    set variable    ${json['data']['stays'][2]['stayId']}
    ${stayId3_roomNo}=    set variable    ${json['data']['stays'][2]['roomNo']}
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userId=uid100&orderLockId=${stayId3}&userName=u&orderNo=${orderNo}&hasLock=0&oldRoomNo=${stayId3_roomNo}&newRoomNo=${stayId1_roomNo}&cleanStatus=1
    HttpLibrary.HTTP.POST    /srmAppApi/changRoom.do
    log response body
    Response Body Should Contain    "errcode":"1"
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&stayId=${stayId1}&userName=u
    HttpLibrary.HTTP.POST    /sm/common/order/cancelStay.do
    log response body
    Response Body Should Contain    "code":"0"
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&orderLockId=${stayId2}&lockPwdMsgSW=0&userName=u&roomNo=${stayId2_roomNo}&keytype=customer&token=QaBs3Qe9WBcs2db&orderNo=${orderNo}
    HttpLibrary.HTTP.POST    /olapi/startChoose.do
    log response body
    Response Body Should Contain    XQ_startPwd({"dataMap":{"hasLock":"0","lockType":""},"ret":"0","ver":"1.0"})
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&orderLockId=${stayId2}&lockPwdMsgSW=0&userName=u&roomNo=${stayId2_roomNo}&keytype=hzkeeper&token=QaBs3Qe9WBcs2db&orderNo=${orderNo}
    HttpLibrary.HTTP.POST    /olapi/startChoose.do
    log response body
    Response Body Should Contain    XQ_startPwd({"dataMap":{"hasLock":"0","lockType":""},"ret":"0","ver":"1.0"})
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userId=uid100&orderLockId=${stayId3}&userName=u&orderNo=${orderNo}&hasLock=0&oldRoomNo=${stayId3_roomNo}&newRoomNo=${stayId1_roomNo}&cleanStatus=1
    HttpLibrary.HTTP.POST    /srmAppApi/changRoom.do
    log response body
    Response Body Should Contain    "errcode":"0"
    ${get_changroom_stayId}=    get Response body
    ${json}    to json    ${get_changroom_stayId}
    ${stayId3}=    set variable    ${json['dataMap']['orderLockId']}
    #${stayId3_roomNo}=    set variable    ${stayId1_roomNo}
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&orderLockId=${stayId3}&lockPwdMsgSW=0&userName=u&roomNo=${stayId1_roomNo}&keytype=customer&token=QaBs3Qe9WBcs2db&orderNo=${orderNo}
    HttpLibrary.HTTP.POST    /olapi/startChoose.do
    log response body
    Response Body Should Contain    XQ_startPwd({"dataMap":{"hasLock":"0","lockType":""},"ret":"0","ver":"1.0"})
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userId=uid100&orderLockId=${stayId3}&userName=u&orderNo=${orderNo}&hasLock=0&oldRoomNo=${stayId1_roomNo}&newRoomNo=${stayId3_roomNo}&cleanStatus=1
    HttpLibrary.HTTP.POST    /srmAppApi/changRoom.do
    log response body
    Response Body Should Contain    "errcode":"0"
    ${get_changroom_stayId}=    get Response body
    ${json}    to json    ${get_changroom_stayId}
    ${stayId3}=    set variable    ${json['dataMap']['orderLockId']}
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&orderLockId=${stayId3}&lockPwdMsgSW=0&userName=u&roomNo=${stayId3_roomNo}&keytype=hzkeeper&token=QaBs3Qe9WBcs2db&orderNo=${orderNo}
    HttpLibrary.HTTP.POST    /olapi/startChoose.do
    log response body
    Response Body Should Contain    XQ_startPwd({"dataMap":{"hasLock":"0","lockType":""},"ret":"0","ver":"1.0"})
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userGuid=uid100&operateType=2&hotelNo=${hotelNo}
    HttpLibrary.HTTP.POST    /offlineInfo/hotelInfo/updateHotel.do
    Response Body Should Contain    "code":"0"
    Response Body Should Contain    "msg":"门店数据删除成功"
    log response body

取消订单
    #门店1:取消订单
    create http context    l-pmstest1.sp.dev.cn0.qunar.com:8081
    set request body    userId=uid100&userName=u&canCancel=canCancel&statusCode=306&cancelReasonCode=10&orderNo=17060098842414&token=QaBs3Qe9WBcs2db&cancelReasonName=特殊原因
    HttpLibrary.HTTP.POST    /api/updateOrder.do
    log response body
    response body should contain    "errcode":"1015"